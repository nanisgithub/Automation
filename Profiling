version: 2

models:
  - name: NDC_FileValidation_SourceData
    description: "NDC File Data validation checks"
    config:
      tags: ['validation','profiling']  

    # Defines columns used for profiling purposes
    vars:
      profiling_columns:
        - ClaimNumber
        - MemberID
        - ServiceCode
        
    tests:
      - column_null_check:
          columns: "PlaceofService,BillType"
          threshold: 5
          test_name: "PlaceofService_BillType_NullCheck"
      - column_null_check:
          columns: "PrimaryDiagCode,SecondaryDiagCode,DiagCode3,DiagCode4,DiagCode5"
          threshold: 5
          test_name: "DX1_DX5_NullCheck"
          
      - reference_table_check:
          source_columns: ["REPLACE(PrimaryDiagCode, '.', '')", "REPLACE(SecondaryDiagCode, '.', '')"]
          lookup_table: "Contract.MSTR.ICD_Curr"
          lookup_column: "DiagnosisCode_NoDec"
          threshold: 5
          test_name: "DX1_DX2_Lookup_Check"
      - reference_table_check:
          source_columns: ["LEFT(LTRIM(RTRIM(ServiceCode)), 5)"]
          lookup_table: "Contract.MSTR.CPT_Curr"
          lookup_column: "ServiceCode"
          threshold: 5
          test_name: "ServiceCode_Lookup_Check"

      - conditional_value_check:
          column: "ClaimStatus"
          match_values: ["PAID", "P"]
          # Ensures that paid claims have a positive service paid amount
          check_column: "CAST(ServicePaidAmount as money)"
          check_condition: "< 0"
          threshold: 5
          test_name: "PaidClaims_PositivePaidAmount_Check"
